<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GovScope - Map Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.5;
            height: 100vh;
            overflow: hidden;
        }
        
        .app-layout {
            display: grid;
            grid-template-columns: 30% 70%;
            height: 100vh;
        }
        
        .left-panel {
            background: white;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .map-container {
            background: #f1f5f9;
            position: relative;
            overflow: hidden;
        }
        
        /* Header Section */
        .panel-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            background: white;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 20px;
        }
        
        /* Breadcrumb Navigation */
        .breadcrumb-nav {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .breadcrumb-item {
            color: #3b82f6;
            text-decoration: none;
            cursor: pointer;
        }
        
        .breadcrumb-item:hover {
            text-decoration: underline;
        }
        
        .breadcrumb-separator {
            color: #94a3b8;
        }
        
        .breadcrumb-current {
            color: #374151;
            font-weight: 500;
        }
        
        .view-selector {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .view-selector label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #64748b;
        }
        
        .view-selector select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
            background: white;
            min-width: 120px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 40px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.9rem;
            background: #f8fafc;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 1rem;
        }
        
        /* Filters Section */
        .filters-section {
            flex: 1;
            overflow-y: auto;
            padding: 20px 24px;
            min-height: 0;
        }
        
        .filters-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
        }
        
        /* Filter Display Mode Toggle */
        .filter-display-toggle {
            background: #f8fafc;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        
        .toggle-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .toggle-options {
            display: flex;
            gap: 8px;
        }
        
        .toggle-option {
            flex: 1;
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        
        .toggle-option.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .filter-group {
            margin-bottom: 24px;
        }
        
        .filter-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .multiselect-dropdown {
            position: relative;
        }
        
        .multiselect-header {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.2s;
        }
        
        .multiselect-header:hover {
            border-color: #3b82f6;
        }
        
        .multiselect-header.open {
            border-color: #3b82f6;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .multiselect-arrow {
            transition: transform 0.2s;
            color: #64748b;
        }
        
        .multiselect-header.open .multiselect-arrow {
            transform: rotate(180deg);
        }
        
        .multiselect-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #3b82f6;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .multiselect-options.open {
            display: block;
        }
        
        .multiselect-option {
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        
        .multiselect-option:hover {
            background: #f8fafc;
        }
        
        .multiselect-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #3b82f6;
        }
        
        .option-label {
            flex: 1;
            font-size: 0.9rem;
            color: #374151;
        }
        
        .option-count {
            background: #e2e8f0;
            color: #64748b;
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .option-count.active {
            background: #3b82f6;
            color: white;
        }
        
        .advanced-filters {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #f1f5f9;
        }
        
        .advanced-toggle {
            background: none;
            border: none;
            color: #3b82f6;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            padding: 0;
        }
        
        .advanced-toggle:hover {
            text-decoration: underline;
        }
        
        .advanced-content {
            display: none;
            margin-top: 16px;
        }
        
        .advanced-content.expanded {
            display: block;
        }
        
        .range-slider {
            margin: 12px 0;
        }
        
        .range-slider input {
            width: 100%;
            margin: 8px 0;
        }
        
        .range-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #64748b;
        }
        
        /* Performance Warning */
        .performance-warning {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 16px;
            display: none;
        }
        
        .performance-warning.show {
            display: block;
        }
        
        .warning-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #92400e;
            margin-bottom: 4px;
        }
        
        .warning-text {
            font-size: 0.8rem;
            color: #92400e;
            margin-bottom: 8px;
        }
        
        .warning-action {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
        }
        
        /* Resizable Results Summary */
        .results-summary {
            padding: 16px 24px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            position: relative;
            min-height: 80px;
            resize: vertical;
            overflow: auto;
        }
        
        .resize-handle {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #e2e8f0;
            cursor: ns-resize;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .results-summary:hover .resize-handle {
            opacity: 1;
        }
        
        .resize-handle:hover {
            background: #3b82f6;
        }
        
        .results-count {
            font-size: 0.95rem;
            color: #374151;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .results-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #f8fafc;
        }
        
        .action-btn.primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .action-btn.primary:hover {
            background: #2563eb;
        }
        
        /* Getting Started Section */
        .getting-started {
            padding: 16px 24px;
            text-align: center;
            border-top: 1px solid #e2e8f0;
        }
        
        .getting-started h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
        }
        
        .getting-started p {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .quick-stats {
            background: #f8fafc;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .quick-stats-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 4px;
        }
        
        .quick-stats-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #3b82f6;
        }
        
        .recently-viewed {
            text-align: left;
        }
        
        .recently-viewed h4 {
            font-size: 0.85rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
        }
        
        .recent-item {
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 2px;
        }
        
        .recent-item:hover {
            background: #f1f5f9;
        }
        
        .recent-name {
            font-size: 0.85rem;
            color: #374151;
            font-weight: 500;
        }
        
        .recent-details {
            font-size: 0.75rem;
            color: #64748b;
        }
        
        /* Map Styles */
        .map-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0369a1;
            font-size: 1.4rem;
            font-weight: 600;
            position: relative;
        }
        
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .map-control {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s;
            font-weight: 600;
            color: #374151;
        }
        
        .map-control:hover {
            background: #f8fafc;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        /* Reference Boundary Toggle */
        .boundary-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: white;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-width: 180px;
        }
        
        .boundary-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .boundary-option {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            cursor: pointer;
        }
        
        .boundary-option input[type="checkbox"] {
            accent-color: #3b82f6;
        }
        
        .boundary-option label {
            font-size: 0.85rem;
            color: #374151;
            cursor: pointer;
        }
        
        /* Map Hover Tooltip */
        .map-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        
        .tooltip-name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .tooltip-metrics {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        .map-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-width: 220px;
        }
        
        .legend-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        
        .legend-color {
            width: 18px;
            height: 12px;
            border-radius: 3px;
        }
        
        .color-excellent { background: #059669; }
        .color-good { background: #0891b2; }
        .color-fair { background: #ea580c; }
        .color-poor { background: #dc2626; }
        .color-no-data { background: #94a3b8; }
        
        .legend-count {
            margin-left: auto;
            color: #64748b;
            font-size: 0.8rem;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .app-layout {
                grid-template-columns: 35% 65%;
            }
        }
        
        @media (max-width: 768px) {
            .app-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .left-panel {
                max-height: 50vh;
                overflow-y: auto;
            }
            
            .map-legend, .boundary-toggle {
                position: relative;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <!-- Left Panel (30%) -->
        <div class="left-panel">
            <!-- Header -->
            <div class="panel-header">
                <div class="logo">GovScope</div>
                
                <!-- Breadcrumb Navigation -->
                <div class="breadcrumb-nav" id="breadcrumb-nav" style="display: none;">
                    <a href="#" class="breadcrumb-item" onclick="resetToUSView()">United States</a>
                    <span class="breadcrumb-separator">></span>
                    <a href="#" class="breadcrumb-item" onclick="resetToStateView()">Oregon</a>
                    <span class="breadcrumb-separator">></span>
                    <span class="breadcrumb-current">Counties</span>
                </div>
                
                <div class="view-selector">
                    <label for="entity-type">View by:</label>
                    <select id="entity-type">
                        <option value="county">County</option>
                        <option value="city">City</option>
                        <option value="school-district">School District</option>
                        <option value="special-district">Special District</option>
                    </select>
                </div>
                
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" placeholder="Search by name, location, or ID..." onkeyup="handleSearch(this.value)">
                </div>
            </div>
            
            <!-- Filters -->
            <div class="filters-section">
                <div class="filters-title">Filters</div>
                
                <!-- Performance Warning -->
                <div class="performance-warning" id="performance-warning">
                    <div class="warning-title">⚠️ Too Many Entities</div>
                    <div class="warning-text">Showing 15,000+ entities may affect performance. Consider zooming in or applying more filters.</div>
                    <button class="warning-action" onclick="applyPerformanceFilter()">Apply Recommended Filters</button>
                </div>
                
                <!-- Filter Display Toggle -->
                <div class="filter-display-toggle">
                    <div class="toggle-title">Map Display Mode</div>
                    <div class="toggle-options">
                        <div class="toggle-option active" onclick="setDisplayMode('highlight')">Highlight Matches</div>
                        <div class="toggle-option" onclick="setDisplayMode('greyout')">Grey Out Others</div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>Financial Health Score</label>
                    <div class="multiselect-dropdown">
                        <div class="multiselect-header" onclick="toggleDropdown(this)">
                            <span class="selected-text">Excellent, Good (469 entities)</span>
                            <span class="multiselect-arrow">▼</span>
                        </div>
                        <div class="multiselect-options">
                            <div class="multiselect-option">
                                <input type="checkbox" id="fh-excellent" checked>
                                <label for="fh-excellent" class="option-label">Excellent (90-100)</label>
                                <span class="option-count active">127</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="fh-good" checked>
                                <label for="fh-good" class="option-label">Good (70-89)</label>
                                <span class="option-count active">342</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="fh-fair">
                                <label for="fh-fair" class="option-label">Fair (50-69)</label>
                                <span class="option-count">189</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="fh-poor">
                                <label for="fh-poor" class="option-label">Poor (0-49)</label>
                                <span class="option-count">45</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>Revenue Stability Score</label>
                    <div class="multiselect-dropdown">
                        <div class="multiselect-header" onclick="toggleDropdown(this)">
                            <span class="selected-text">Very Strong, Strong (443 entities)</span>
                            <span class="multiselect-arrow">▼</span>
                        </div>
                        <div class="multiselect-options">
                            <div class="multiselect-option">
                                <input type="checkbox" id="rs-very-strong" checked>
                                <label for="rs-very-strong" class="option-label">Very Strong (90-100)</label>
                                <span class="option-count active">156</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="rs-strong" checked>
                                <label for="rs-strong" class="option-label">Strong (70-89)</label>
                                <span class="option-count active">287</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="rs-moderate">
                                <label for="rs-moderate" class="option-label">Moderate (50-69)</label>
                                <span class="option-count">198</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="rs-weak">
                                <label for="rs-weak" class="option-label">Weak (0-49)</label>
                                <span class="option-count">62</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>Total Expenditures</label>
                    <div class="multiselect-dropdown">
                        <div class="multiselect-header" onclick="toggleDropdown(this)">
                            <span class="selected-text">All budget sizes (703 entities)</span>
                            <span class="multiselect-arrow">▼</span>
                        </div>
                        <div class="multiselect-options">
                            <div class="multiselect-option">
                                <input type="checkbox" id="te-100m">
                                <label for="te-100m" class="option-label">$100M+ annually</label>
                                <span class="option-count">89</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="te-50m">
                                <label for="te-50m" class="option-label">$50M - $100M annually</label>
                                <span class="option-count">156</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="te-10m">
                                <label for="te-10m" class="option-label">$10M - $50M annually</label>
                                <span class="option-count">298</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="te-under10m">
                                <label for="te-under10m" class="option-label">Under $10M annually</label>
                                <span class="option-count">160</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>Workforce Analysis</label>
                    <div class="multiselect-dropdown">
                        <div class="multiselect-header" onclick="toggleDropdown(this)">
                            <span class="selected-text">All workforce sizes (703 entities)</span>
                            <span class="multiselect-arrow">▼</span>
                        </div>
                        <div class="multiselect-options">
                            <div class="multiselect-option">
                                <input type="checkbox" id="wa-large">
                                <label for="wa-large" class="option-label">Large workforce (1,000+ employees)</label>
                                <span class="option-count">234</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="wa-medium">
                                <label for="wa-medium" class="option-label">Medium workforce (500-999 employees)</label>
                                <span class="option-count">312</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="wa-small">
                                <label for="wa-small" class="option-label">Small workforce (100-499 employees)</label>
                                <span class="option-count">157</span>
                            </div>
                            <div class="multiselect-option">
                                <input type="checkbox" id="wa-premium">
                                <label for="wa-premium" class="option-label">Premium compensation (Above market avg)</label>
                                <span class="option-count">145</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="advanced-filters">
                    <button class="advanced-toggle" onclick="toggleAdvanced()">
                        <span id="advanced-icon">▼</span>
                        Advanced Filters
                    </button>
                    
                    <div class="advanced-content" id="advanced-content">
                        <div class="filter-group">
                            <label>Population Range</label>
                            <div class="range-slider">
                                <input type="range" min="0" max="1000000" value="50000" id="pop-min">
                                <input type="range" min="0" max="1000000" value="500000" id="pop-max">
                                <div class="range-values">
                                    <span>50K</span>
                                    <span>500K</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Market Tier</label>
                            <div class="multiselect-dropdown">
                                <div class="multiselect-header" onclick="toggleDropdown(this)">
                                    <span class="selected-text">All market tiers (703 entities)</span>
                                    <span class="multiselect-arrow">▼</span>
                                </div>
                                <div class="multiselect-options">
                                    <div class="multiselect-option">
                                        <input type="checkbox" id="mt-premium">
                                        <label for="mt-premium" class="option-label">Premium Market</label>
                                        <span class="option-count">67</span>
                                    </div>
                                    <div class="multiselect-option">
                                        <input type="checkbox" id="mt-emerging">
                                        <label for="mt-emerging" class="option-label">Emerging Market</label>
                                        <span class="option-count">145</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Geographic Region</label>
                            <div class="multiselect-dropdown">
                                <div class="multiselect-header" onclick="toggleDropdown(this)">
                                    <span class="selected-text">West (156 entities)</span>
                                    <span class="multiselect-arrow">▼</span>
                                </div>
                                <div class="multiselect-options">
                                    <div class="multiselect-option">
                                        <input type="checkbox" id="gr-west" checked>
                                        <label for="gr-west" class="option-label">West</label>
                                        <span class="option-count active">156</span>
                                    </div>
                                    <div class="multiselect-option">
                                        <input type="checkbox" id="gr-south">
                                        <label for="gr-south" class="option-label">South</label>
                                        <span class="option-count">287</span>
                                    </div>
                                    <div class="multiselect-option">
                                        <input type="checkbox" id="gr-northeast">
                                        <label for="gr-northeast" class="option-label">Northeast</label>
                                        <span class="option-count">124</span>
                                    </div>
                                    <div class="multiselect-option">
                                        <input type="checkbox" id="gr-midwest">
                                        <label for="gr-midwest" class="option-label">Midwest</label>
                                        <span class="option-count">136</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Resizable Results Summary -->
            <div class="results-summary">
                <div class="resize-handle"></div>
                <div class="results-count">469 counties match your criteria</div>
                <div class="results-actions">
                    <button class="action-btn">Clear All</button>
                    <button class="action-btn primary">Save Filter</button>
                    <button class="action-btn" onclick="jumpToEntity()">Jump to Entity</button>
                </div>
            </div>
            
            <!-- Getting Started -->
            <div class="getting-started">
                <h3>Get Started</h3>
                <p>Select entities on the map to view detailed financial and workforce intelligence</p>
                
                <div class="quick-stats">
                    <div class="quick-stats-title">Tracking Nationwide</div>
                    <div class="quick-stats-value">3,143</div>
                    <div style="font-size: 0.8rem; color: #64748b; margin-top: 4px;">Counties</div>
                </div>
                
                <div class="recently-viewed">
                    <h4>Recently Viewed</h4>
                    <div class="recent-item" onclick="loadEntityDetail('Clackamas County')">
                        <div class="recent-name">Clackamas County</div>
                        <div class="recent-details">Oregon • Score: 96.3</div>
                    </div>
                    <div class="recent-item" onclick="loadEntityDetail('King County')">
                        <div class="recent-name">King County</div>
                        <div class="recent-details">Washington • Score: 94.1</div>
                    </div>
                    <div class="recent-item" onclick="loadEntityDetail('Alameda County')">
                        <div class="recent-name">Alameda County</div>
                        <div class="recent-details">California • Score: 91.7</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Map Container (70%) -->
        <div class="map-container">
            <div class="map-placeholder" id="map-placeholder">
                Interactive Map of United States Counties
                <div style="position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 0.9rem; opacity: 0.7;">
                    Hover over entities to see details • Click to view full analysis
                </div>
            </div>
            
            <!-- Map Hover Tooltip -->
            <div class="map-tooltip" id="map-tooltip">
                <div class="tooltip-name">Clackamas County</div>
                <div class="tooltip-metrics">Financial Health: 96.3 • Budget: $122M</div>
            </div>
            
            <div class="map-controls">
                <div class="map-control" title="Zoom In" onclick="zoomIn()">+</div>
                <div class="map-control" title="Zoom Out" onclick="zoomOut()">−</div>
                <div class="map-control" title="Reset to US View" onclick="resetToUSView()">⌂</div>
            </div>
            
            <!-- Reference Boundary Toggle -->
            <div class="boundary-toggle">
                <div class="boundary-title">Reference Boundaries</div>
                <div class="boundary-option">
                    <input type="checkbox" id="show-states" checked>
                    <label for="show-states">Show State Outlines</label>
                </div>
                <div class="boundary-option">
                    <input type="checkbox" id="show-counties">
                    <label for="show-counties">Show County Boundaries</label>
                </div>
                <div class="boundary-option">
                    <input type="checkbox" id="show-metro">
                    <label for="show-metro">Show Metro Areas</label>
                </div>
            </div>
            
            <div class="map-legend">
                <div class="legend-title">Financial Health Score</div>
                <div class="legend-item">
                    <div class="legend-color color-excellent"></div>
                    <span>Excellent (90-100)</span>
                    <span class="legend-count">127</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-good"></div>
                    <span>Good (70-89)</span>
                    <span class="legend-count">342</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-fair"></div>
                    <span>Fair (50-69)</span>
                    <span class="legend-count">189</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-poor"></div>
                    <span>Poor (0-49)</span>
                    <span class="legend-count">45</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-no-data"></div>
                    <span>No Data</span>
                    <span class="legend-count">23</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Map state management
        let currentView = 'us';
        let currentEntityType = 'county';
        let displayMode = 'highlight'; // or 'greyout'
        
        // Multiselect dropdown functionality
        function toggleDropdown(header) {
            const dropdown = header.parentElement;
            const options = dropdown.querySelector('.multiselect-options');
            const isOpen = options.classList.contains('open');
            
            // Close all other dropdowns
            document.querySelectorAll('.multiselect-options.open').forEach(opt => {
                opt.classList.remove('open');
                opt.parentElement.querySelector('.multiselect-header').classList.remove('open');
            });
            
            if (!isOpen) {
                options.classList.add('open');
                header.classList.add('open');
            }
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.multiselect-dropdown')) {
                document.querySelectorAll('.multiselect-options.open').forEach(opt => {
                    opt.classList.remove('open');
                    opt.parentElement.querySelector('.multiselect-header').classList.remove('open');
                });
            }
        });
        
        // Handle checkbox changes in multiselect
        document.querySelectorAll('.multiselect-option input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const count = this.parentElement.querySelector('.option-count');
                if (this.checked) {
                    count.classList.add('active');
                } else {
                    count.classList.remove('active');
                }
                
                updateDropdownHeader(this);
                updateResultsCount();
                updateMapDisplay();
                checkPerformanceWarning();
            });
        });
        
        function updateDropdownHeader(checkbox) {
            const dropdown = checkbox.closest('.multiselect-dropdown');
            const header = dropdown.querySelector('.multiselect-header .selected-text');
            const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                header.textContent = 'None selected (0 entities)';
            } else if (checkboxes.length === 1) {
                const label = checkboxes[0].nextElementSibling.textContent;
                const count = checkboxes[0].parentElement.querySelector('.option-count').textContent;
                header.textContent = `${label.split('(')[0].trim()} (${count} entities)`;
            } else {
                const labels = Array.from(checkboxes).map(cb => 
                    cb.nextElementSibling.textContent.split('(')[0].trim()
                );
                const totalCount = Array.from(checkboxes).reduce((sum, cb) => {
                    const countText = cb.parentElement.querySelector('.option-count').textContent;
                    return sum + parseInt(countText);
                }, 0);
                header.textContent = `${labels.join(', ')} (${totalCount} entities)`;
            }
        }
        
        // Display mode toggle
        function setDisplayMode(mode) {
            displayMode = mode;
            document.querySelectorAll('.toggle-option').forEach(opt => opt.classList.remove('active'));
            event.target.classList.add('active');
            updateMapDisplay();
        }
        
        // Performance warning
        function checkPerformanceWarning() {
            const checkedFilters = document.querySelectorAll('input[type="checkbox"]:checked').length;
            const entityCount = parseInt(document.querySelector('.results-count').textContent.split(' ')[0]);
            
            if (entityCount > 10000) {
                document.getElementById('performance-warning').classList.add('show');
            } else {
                document.getElementById('performance-warning').classList.remove('show');
            }
        }
        
        function applyPerformanceFilter() {
            // Apply recommended filters to reduce entity count
            document.getElementById('fh-excellent').checked = true;
            document.getElementById('fh-good').checked = true;
            document.getElementById('fh-fair').checked = false;
            document.getElementById('fh-poor').checked = false;
            
            // Update UI
            document.querySelectorAll('.option-count').forEach(count => count.classList.remove('active'));
            document.querySelector('#fh-excellent').parentElement.querySelector('.option-count').classList.add('active');
            document.querySelector('#fh-good').parentElement.querySelector('.option-count').classList.add('active');
            
            updateDropdownHeader(document.getElementById('fh-excellent'));
            updateResultsCount();
            document.getElementById('performance-warning').classList.remove('show');
        }
        
        // Map navigation
        function resetToUSView() {
            currentView = 'us';
            document.getElementById('breadcrumb-nav').style.display = 'none';
            console.log('Reset to US view');
            updateMapDisplay();
        }
        
        function resetToStateView() {
            currentView = 'state';
            updateBreadcrumb('Oregon', 'Counties');
            console.log('Reset to state view');
            updateMapDisplay();
        }
        
        function updateBreadcrumb(state, level) {
            const breadcrumb = document.getElementById('breadcrumb-nav');
            breadcrumb.style.display = 'flex';
            // Update breadcrumb content dynamically based on zoom level
        }
        
        function zoomIn() {
            console.log('Zoom in');
            // If zoomed into state level, show breadcrumb
            if (currentView === 'us') {
                currentView = 'state';
                updateBreadcrumb('Oregon', 'Counties');
            }
        }
        
        function zoomOut() {
            console.log('Zoom out');
            if (currentView === 'state') {
                resetToUSView();
            }
        }
        
        // Search functionality
        function handleSearch(query) {
            if (query.length > 2) {
                console.log('Searching for:', query);
                // Implement search highlighting
                simulateSearchResults(query);
            }
        }
        
        function simulateSearchResults(query) {
            // Simulate search highlighting on map
            console.log('Highlighting search results for:', query);
        }
        
        function jumpToEntity() {
            const query = document.querySelector('.search-box input').value;
            if (query) {
                console.log('Jumping to entity:', query);
                // Zoom to specific entity
                currentView = 'entity';
                updateBreadcrumb('Oregon', 'Clackamas County');
            }
        }
        
        // Map hover functionality
        document.getElementById('map-placeholder').addEventListener('mousemove', function(e) {
            const tooltip = document.getElementById('map-tooltip');
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Simulate entity detection
            if (x > 200 && x < 400 && y > 150 && y < 350) {
                tooltip.style.display = 'block';
                tooltip.style.left = (e.clientX + 10) + 'px';
                tooltip.style.top = (e.clientY - 40) + 'px';
            } else {
                tooltip.style.display = 'none';
            }
        });
        
        document.getElementById('map-placeholder').addEventListener('mouseleave', function() {
            document.getElementById('map-tooltip').style.display = 'none';
        });
        
        // Map click functionality
        document.getElementById('map-placeholder').addEventListener('click', function(e) {
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Simulate entity click
            if (x > 200 && x < 400 && y > 150 && y < 350) {
                loadEntityDetail('Clackamas County');
            }
        });
        
        function loadEntityDetail(entityName) {
            console.log('Loading detailed view for:', entityName);
            // This would transition to the Budget Intelligence or Workforce Analysis view
            // while maintaining the map state and filter context
            alert(`Loading detailed analysis for ${entityName}.\n\nThis would transition to the Budget Intelligence tab while preserving:\n• Current filter selections\n• Map zoom level and position\n• Navigation breadcrumbs`);
        }
        
        // Advanced filters toggle
        function toggleAdvanced() {
            const content = document.getElementById('advanced-content');
            const icon = document.getElementById('advanced-icon');
            
            content.classList.toggle('expanded');
            icon.textContent = content.classList.contains('expanded') ? '▲' : '▼';
        }
        
        // Entity type selector
        document.getElementById('entity-type').addEventListener('change', function() {
            currentEntityType = this.value;
            console.log('Switched to entity type:', currentEntityType);
            updateResultsCount();
            updateMapDisplay();
            checkPerformanceWarning();
        });
        
        // Action buttons
        document.querySelector('.action-btn:not(.primary):not([onclick])').addEventListener('click', function() {
            // Clear all filters
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
                cb.parentElement.querySelector('.option-count').classList.remove('active');
                updateDropdownHeader(cb);
            });
            updateResultsCount();
            updateMapDisplay();
        });
        
        document.querySelector('.action-btn.primary').addEventListener('click', function() {
            console.log('Saving current filter configuration');
            // Implement save filter functionality
        });
        
        // Results count update
        function updateResultsCount() {
            const checkedFilters = document.querySelectorAll('input[type="checkbox"]:checked').length;
            
            let baseCount;
            switch(currentEntityType) {
                case 'county': baseCount = 3143; break;
                case 'city': baseCount = 19495; break;
                case 'school-district': baseCount = 13452; break;
                case 'special-district': baseCount = 35000; break;
                default: baseCount = 3143;
            }
            
            // Calculate based on current selections
            const filteredCount = checkedFilters > 0 ? 469 : baseCount;
            
            document.querySelector('.results-count').textContent = 
                `${filteredCount.toLocaleString()} ${currentEntityType.replace('-', ' ')}s match your criteria`;
        }
        
        function updateMapDisplay() {
            console.log('Updating map display:', {
                view: currentView,
                entityType: currentEntityType,
                displayMode: displayMode
            });
            // Implement map updates based on filters and display mode
        }
        
        // Boundary toggle functionality
        document.querySelectorAll('.boundary-option input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                console.log('Boundary toggle:', this.id, this.checked);
                updateMapDisplay();
            });
        });
        
        // Drag to resize results summary
        let isResizing = false;
        let startY;
        let startHeight;
        
        document.querySelector('.resize-handle').addEventListener('mousedown', function(e) {
            isResizing = true;
            startY = e.clientY;
            startHeight = parseInt(document.defaultView.getComputedStyle(document.querySelector('.results-summary')).height, 10);
            document.addEventListener('mousemove', doResize);
            document.addEventListener('mouseup', stopResize);
            e.preventDefault();
        });
        
        function doResize(e) {
            if (!isResizing) return;
            const newHeight = startHeight - (e.clientY - startY);
            if (newHeight > 60 && newHeight < 300) {
                document.querySelector('.results-summary').style.height = newHeight + 'px';
            }
        }
        
        function stopResize() {
            isResizing = false;
            document.removeEventListener('mousemove', doResize);
            document.removeEventListener('mouseup', stopResize);
        }
        
        // Initialize default selections
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.multiselect-dropdown').forEach(dropdown => {
                const firstCheckbox = dropdown.querySelector('input[type="checkbox"]');
                if (firstCheckbox) {
                    updateDropdownHeader(firstCheckbox);
                }
            });
            
            checkPerformanceWarning();
        });
    </script>
</body>
</html>
